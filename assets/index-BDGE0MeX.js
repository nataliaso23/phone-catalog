import{r as s,G as y,j as e,I as j,i as g,c as w,u as T,a as B,g as f}from"./index-Cmpk2Ixb.js";import{B as $,c as F}from"./Breadcrumbs-BI6SChkw.js";import{P as O}from"./ProductsList-CIbhDa0R.js";import{L as R}from"./Loader-BiGTqj4c.js";import"./ProductCard-iUAZ2YWl.js";const C=s.memo(({label:c,selected:d,options:t,onChange:r})=>{const{theme:o}=s.useContext(y),[n,l]=s.useState(!1),u=s.useRef(null);s.useEffect(()=>{const i=_=>{u.current&&!u.current.contains(_.target)&&l(!1)};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[]);const p=s.useCallback(()=>l(i=>!i),[]),a=s.useCallback(i=>{r(i),l(!1)},[r]);return e.jsxs("div",{ref:u,className:"dropdown",children:[e.jsx("div",{className:"dropdown__label",children:c}),e.jsxs("button",{className:`dropdown__button ${n?"dropdown__button--open":""}`,onClick:p,children:[e.jsx("div",{className:"dropdown__title",children:d}),e.jsx("div",{className:"dropdown__icon",children:e.jsx(j,{icon:n?g.arrow_down[o]:g.arrow_right[o]})})]}),n&&e.jsx("ul",{className:"dropdown__options",children:t.map(i=>e.jsx("li",{className:"dropdown__option",onClick:()=>a(i),children:i},i))})]})});C.displayName="Dropdown";const N=4,q=({total:c,perPage:d,currentPage:t,onPageChange:r})=>{const{theme:o}=s.useContext(y),n=s.useMemo(()=>Math.ceil(c/d),[d,c]),[l,u]=s.useMemo(()=>{let p=Math.max(1,t-1),a=Math.min(n,t+2);return a-p+1<N&&(p===1?a=Math.min(n,p+N-1):p=Math.max(1,a-N+1)),[p,a]},[t,n]);return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:w("pagination__button",{"pagination__button--disabled":t===1}),onClick:()=>r(t-1),disabled:t===1,children:t===1?e.jsx(j,{icon:g.arrow_left__disabled[o]}):e.jsx(j,{icon:g.arrow_left[o]})}),e.jsx("div",{className:"pagination__button-container",children:Array.from({length:u-l+1},(p,a)=>e.jsx("button",{className:w("pagination__button-page",{"pagination__button-page--active":t===l+a}),onClick:()=>r(l+a),children:l+a},l+a))}),e.jsx("button",{className:w("pagination__button",{"pagination__button--disabled":t===n}),onClick:()=>r(t+1),disabled:t===n,children:t===n?e.jsx(j,{icon:g.arrow_right__disabled[o]}):e.jsx(j,{icon:g.arrow_right[o]})})]})},G=(c,{sortBy:d,query:t})=>{let r=[...c];switch(t&&(r=r.filter(o=>o.name.toLowerCase().includes(t.toLowerCase().trim()))),d){case"Newest":return r.sort((o,n)=>n.year-o.year);case"Alphabetically":return r.sort((o,n)=>o.name.localeCompare(n.name));case"Cheapest":return r.sort((o,n)=>o.fullPrice-n.fullPrice);default:return r}},J=({category:c})=>{const{allProducts:d}=s.useContext(y),[t,r]=s.useState(!1),[o,n]=s.useState(null),[l,u]=T(),p=l.get("sort")||"Newest",a=l.get("perPage")||"All",i=Number(l.get("page"))||1,_=l.get("query")||"",M=B(),k=s.useMemo(()=>M.pathname.split("/")[1],[M.pathname]),v=s.useMemo(()=>d.filter(m=>m.category===c),[d,c]),h=s.useMemo(()=>G(v,{sortBy:p,query:_}),[v,_,p]),x=s.useMemo(()=>h.length,[h.length]),L=s.useCallback(m=>{u(f(l,m==="Newest"?{sort:null}:{sort:m}))},[l,u]),A=s.useCallback(m=>{u(f(l,m==="All"?{perPage:null,page:null}:{perPage:m,page:"1"}))},[l,u]),I=s.useCallback(m=>{const P=m===1?{page:null}:{page:String(m)};u(f(l,P))},[l,u]),S=s.useMemo(()=>a==="All"?1:Math.ceil(x/+a),[x,a]),b=s.useMemo(()=>(i-1)*+a,[i,a]),E=s.useMemo(()=>a==="All"?h:h.slice(b,b+ +a),[a,b,h]);return s.useEffect(()=>{r(!0),n(null);const m=setTimeout(()=>{try{(!d||d.length===0)&&n("Failed to load products")}catch{n("Failed to load products")}finally{r(!1)}},500);return()=>clearTimeout(m)},[c,d]),e.jsxs("div",{className:"productPage",children:[t&&e.jsx(R,{}),!t&&o&&e.jsxs("div",{className:"productPage__error",children:[e.jsx("p",{children:"Something went wrong. Please try again."}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reload"})]}),!t&&!o&&!h.length&&!_?e.jsx("div",{className:"productPage__no-products",children:e.jsxs("p",{children:["There are no ",c," yet."]})}):null,!t&&!o&&!h.length&&_?e.jsx("p",{className:"productPage__no-products",children:`There are no ${k} matching the query`}):null,!t&&!o&&h.length?e.jsxs(e.Fragment,{children:[e.jsx($,{productType:c}),e.jsx("h1",{className:"productPage__title",children:c&&`${F(c)} page`}),e.jsx("span",{className:"productPage__description",children:`${x} model${x!==1?"s":""}`}),e.jsxs("div",{className:"productPage__dropdown",children:[e.jsx("div",{className:"productPage__dropdown--sortBy",children:e.jsx(C,{label:"Sort by",selected:p,options:["Newest","Alphabetically","Cheapest"],onChange:L})}),e.jsx("div",{className:"productPage__dropdown--itemsPerPage",children:e.jsx(C,{label:"Items on page",selected:a,options:["4","8","16","All"],onChange:A})})]}),e.jsx(O,{products:E,displayType:"with-discount"}),a!=="All"&&S>1&&e.jsx(q,{total:x,perPage:+a,currentPage:i,onPageChange:I})]}):null]})};export{J as ProductPage};
